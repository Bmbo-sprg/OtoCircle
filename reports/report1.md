# 音楽管理・配信サービスの概念設計

**計算機科学実験及演習 4: データベース 課題 1 レポート**
**京都大学工学部情報学科 計算機科学コース 3 年生 王篤遥**
**学生番号: 1029332225, 提出日: 2023-10-06**

## 音楽管理・配信サービス「OtoCircle」の概要

OtoCircle は、音楽クリエイターと作曲系サークルのための楽曲管理・配信サービスです。

従来の音楽配信サービスが持つ、音楽の再生・レコメンド・プレイリスト作成などリスナーサイドの機能に加えて、音楽クリエイターが自分で音楽を投稿でき、サークル内あるいはグローバルに公開できるクリエイターサイドの機能も備えます。

### OtoCircle の目的

音楽ストリーミング配信サービスは、近年人気のあるオンラインサービスです。それらのサービスは、以下のような基本的な機能を共通して持っています。

- リスナーサイドの機能 (音楽の検索、レコメンド、再生、プレイリスト作成など)
- クリエイターサイドの機能 (音楽の登録、ストリーミングによる収益還元など)

ただし、クリエイターサイドの機能は、著作権管理事業者を通じて間接的に行われていることが多く、クリエイターとリスナーがフラットな関係で活発にインタラクションを持てているとは言い難いです。

また、ネットインディーズ音楽 (同人音楽) や作曲系サークルが台頭しています。同人音楽やサークルでは、メンバーが制作した未リリースの音楽を聴き合って、感性や技術を磨いていきます。クリエイターとリスナーがフラットな関係でインタラクションをするサービスが求められています。

よって、既存の音楽配信サービスに加えてクリエイターサイドの機能を充実させ、さらにクリエイター・リスナーのフラットなインタラクションを促進し、両者を繋げるサービスが重要となります。

## OtoCircle の機能

OtoCircle は、以下の機能を持つアプリケーションとなる予定です。

- ユーザー機能とサークル機能
    - ユーザーの作成・検索・削除、プロフィールの閲覧・編集
    - サークルの作成・検索・削除、プロフィールの閲覧・編集
    - ユーザーのサークルへの所属関係の設定・解除
- 音楽ストリーミングアプリとしての機能
    - 音楽の検索
    - おすすめや新作のレコメンド
    - 音楽のストリーミング再生
    - 音楽の情報の閲覧
- 音楽投稿サイト、楽曲データベースとしての機能
    - 音楽の投稿・削除、情報の編集  <!-- 普通のインデクス情報に加えて BPM とかも -->
    - プレイリストへの追加・閲覧・編集・削除
    - 音楽・プレイリストの公開範囲 (自分だけ／サークル／グローバル) 設定
- 音楽を介したユーザー同士のインタラクション機能
    - コメントの追加・閲覧・編集・削除

## ユーザーのロールについて

OtoCircle は、音楽のクリエイターとリスナーという非対称な関係をフラットにして、新しいインタラクションを促進するという観点から、ユーザーをクリエイター・リスナーというロールに分けておりません。

ユーザーのロールは、サークルやサービス全体の権限管理のために以下の通り用意します。

### システム管理者 (System Administrator)

システム全体に対し制御権限を持ちます。

管理画面を用意し、ユーザーの作成・閲覧・更新・削除 (CRUD)、ロールの設定などの一括管理や、その他諸エンティティの CRUD を一元的に行えます。

### サークル管理者 (Circle Administrator)

自サークルに対する CRUD を制御する権限を持ちます。

他ユーザーをサークルに追加・解除することができます。

サークル公式としてのプレイリストの CRUD を行うこともできます。

### ユーザー (User)

以上の権限を持ちませんが、その他のユーザー機能・ストリーミング機能・投稿機能・インタラクション機能を持ちます。

### ロールごとの機能比較

各ロールは、下表の通り権限が異なります。

| |SAdmin|CAdmin|User|
|:-|:-:|:-:|:-:|
|ユーザーの作成・検索・閲覧|○|○|○|
|ユーザーの削除・編集|○|自分のみ|自分のみ|
|サークルの作成・検索・閲覧|○|○|○|
|サークルの削除・編集|○|自サークルのみ| |
|任意ユーザー・サークルの所属関係の設定・解除|○| | |
|任意ユーザーの自サークルへの招待・キック|○|○| |
|自分の任意サークルへの応募・脱退|○|○|○|
|音楽の投稿|○|○|○|
|音楽の検索・レコメンド・閲覧・再生|○|○|○|
|音楽の削除・編集|○|自分ののみ|自分ののみ|
|個人プレイリストの作成|○|○|○|
|サークルプレイリストの作成|○|○| |
|プレイリストの検索・閲覧|○|公開のみ|公開のみ|
|プレイリストの削除・編集|○|自サークルのみ|自分ののみ|
|コメントの追加・検索・閲覧|○|○|○|
|コメントの削除|○|自分ののみ|自分ののみ|

## OtoCircle の技術

### ER 図

#### 概念モデル

![ER diagram of OtoCircle](image-1.png)

##### ユーザー (users)

- `id` PK: ユーザーの識別 ID
- `login_id`: ログイン ID
- `password`: ログインパスワード。ハッシュ化されるはず
- `is_system_admin`: システム管理者か否か
- `name`: ニックネーム
- `bio`: 自己紹介

##### 作曲者名義 (composers)

ユーザーとは many-to-many 関係です。
一人のユーザーが複数の名義で曲を投稿し、一つの合作名義が複数のユーザーを持ちえます。

- `id` PK: 作曲者名義の識別 ID
- `name`: 作曲者名義

##### サークル (circles)

ユーザーの集まりであり、音楽の公開範囲の一つの尺度となっています。

ユーザーとは many-to-many 関係です。
一人のユーザーは複数のサークルに所属し、一つのサークルは複数のユーザーを持ちえます。

また、サークルの代表 (owner) に関してユーザーとは one-to-many 関係です。
サークルは必ず 1 人だけ代表者を持ちます。代表者は必ずサークル管理者です。

- `id` PK: サークルの識別 ID
- `name`: サークル名
- `owner_id`: サークル代表のユーザー ID

##### 音楽 (musics)

作曲者名義とは one-to-many 関係です。
音楽は必ず 1 つだけ作曲者名義を持ちます。

- `id`: 音楽の識別 ID
- `name`: 曲名
- `composer_id`: 作曲者の作曲者名義 ID
- `length`: 曲の長さ (後述するコメントの位置に利用)
- `bpm`: 曲の BPM (DJ などのユースケースに便利)
- `lyrics`: 曲の歌詞
- `description`: 曲の概要
- `visible_to`: 公開範囲 (自分のみ / サークル / グローバル)

##### プレイリスト (playlists)

音楽をリストで集めたもの。サークルのアルバムとしての扱いや、各個人の愛聴盤をまとめたり、作曲の際のリファレンスをまとめたり、DJ のセットリストとして使えます。

サークルのプレイリストの場合、サークルと one-to-many 関係です。
個人のプレイリストの場合、ユーザーと one-to-many 関係です。
プレイリストは、必ず 1 つのサークルか 1 人の個人に紐づきます。

- `id`: プレイリストの識別 ID
- `name`: プレイリスト名
- `is_circle`: `true` ならサークルプレイリスト、`false` なら個人プレイリスト
- `creator_id`: polymorphic な値。`is_circle == true` ならサークル ID、`is_circle == false` ならユーザー ID
- `description`: プレイリストの説明
- `visible_to`: 公開範囲 (自分のみ / サークル / グローバル)

##### コメント (comments)

音楽の特定の位置にコメントをすることができる。ニコニコ動画のコメントのようにリアルタイムで表示できることを目指す。

音楽とユーザーとは、それぞれ one-to-many 関係にあります。
コメントは必ず 1 つの音楽と 1 人のユーザーに紐づきます。

- `id`: コメントの識別 ID
- `music_id`: コメントの付いている音楽の ID
- `user_id`: コメントをしたユーザーの ID
- `position`: コメントの曲での位置。音楽の `length` より短い
- `contents`: コメントの内容

#### 論理モデル

課題 2, 3 にて構築する。
